window.__require=function e(t,o,n){function c(s,l){if(!o[s]){if(!t[s]){var r=s.split("/");if(r=r[r.length-1],!t[r]){var a="function"==typeof __require&&__require;if(!l&&a)return a(r,!0);if(i)return i(r,!0);throw new Error("Cannot find module '"+s+"'")}s=r}var h=o[s]={exports:{}};t[s][0].call(h.exports,function(e){return c(t[s][1][e]||e)},h,h.exports,e,t,o,n)}return o[s].exports}for(var i="function"==typeof __require&&__require,s=0;s<n.length;s++)c(n[s]);return c}({BeginGame:[function(e,t,o){"use strict";cc._RF.push(t,"eb047DzR0lHZ7OWWcHtl0c7","BeginGame"),cc.Class({extends:cc.Component,properties:{Info_dlg:cc.Node},onLoad:function(){Global.gameover=0,Global.gamepause=0,Global.gamelevel=1,Global.gamescore=0,Global.gamesublevel=1,Global.gamelevelscore=0},onStart:function(){cc.director.loadScene("Game")},onInfo:function(){this.Info_dlg.getComponent(cc.Animation).play("layerout")},onDlg:function(){this.Info_dlg.getComponent(cc.Animation).play("layerin")}}),cc._RF.pop()},{}],BlockLine:[function(e,t,o){"use strict";cc._RF.push(t,"5ae43rqOMNPsLDuh6p3f4EU","BlockLine"),cc.Class({extends:cc.Component,properties:{block_count:cc.Integer,block:cc.Prefab,fog:cc.Prefab,r_blocks:[]},start:function(){},initBlocks:function(){var e=0,t=.834;this.block_count=6;for(var o=0;o<6;o++){var n=cc.instantiate(this.block);n.getComponent("Block").onChange(Math.round(8*Math.random())),n.getComponent(cc.Widget).isAbsoluteTop=!1,n.getComponent(cc.Widget).isAbsoluteBottom=!1,n.getComponent(cc.Widget).top=e,n.getComponent(cc.Widget).bottom=t,e+=.166,t-=.166,this.node.addChild(n)}},onClickBlock:function(e){this.node.getParent().getComponent("blockNode").onBlockClicked(e,this.node.getComponent(cc.Widget).left)},getBlockState:function(){for(var e=[],t=this.node.children.length,o=t-1;o>=0;o--)e[t-o-1]=this.node.children[o].getComponent("Block").block_flg;for(o=e.length;o<6;o++)e[o]=0;return e},setRemoveBlocks:function(e){this.r_blocks[this.r_blocks.length]=this.node.children.length-e-1},startFogBlock:function(){var e=cc.instantiate(this.fog);e.position=this.node.children[this.r_blocks[0]].position,e.getComponent(cc.Animation).play("fog"),this.node.addChild(e),this.r_blocks=[]},getLineMark:function(){for(var e=[],t=0;t<this.r_blocks.length;t++){var o={left:0,top:0,mark:0,type:0,multi:0};o.left=this.node.getComponent(cc.Widget).left,o.top=this.node.children[this.r_blocks[t]].getComponent(cc.Widget).top;var n=this.node.children[this.r_blocks[t]].getComponent("Block").block_stat;4==n||5==n||7==n?o.mark=100:6==n?(o.mark=10,o.type=1):8==n&&(o.mark=10,o.multi=1,o.type=1),e[e.length]=o}return e},startRemoveBlocks:function(){console.log(this.r_blocks);for(var e=[],t=0;t<this.node.children.length;t++)e[t]={top:0,bottom:0};for(t=0;t<this.r_blocks.length;t++)for(var o=0;o<=this.r_blocks[t];o++)e[o].top++,e[o].bottom++;for(t=0;t<this.r_blocks.length;t++){var n=cc.instantiate(this.fog);n.position=this.node.children[this.r_blocks[t]].position,n.getComponent(cc.Animation).play("fog"),this.node.addChild(n),this.node.children[this.r_blocks[t]].destroy(),this.block_count--}console.log(e);for(t=0;t<e.length;t++)if(0!=e[t].top){var c=this.node.children[t].getComponent(cc.Widget).top+.166*e[t].top,i=this.node.children[t].getComponent(cc.Widget).bottom-.166*e[t].bottom;console.log(c),console.log(i),this.node.children[t].getComponent("Block").BlockDown(c,i)}if(0==this.block_count){var s=this;cc.tween(this.node).delay(.3).call(function(){s.node.destroy()}).start()}this.r_blocks=[]}}),cc._RF.pop()},{}],Block:[function(e,t,o){"use strict";cc._RF.push(t,"b2b48e4ytlAzLF9BNvu6Xc+","Block"),cc.Class({extends:cc.Component,properties:{block_stat:cc.Integer,block_flg:cc.Integer},start:function(){},onChange:function(e){1==e||5==e||0==e?this.block_flg=1:2==e||4==e?this.block_flg=2:3==e||7==e?this.block_flg=3:6!=e&&8!=e||(this.block_flg=4),this.block_stat=0==e?1:e;var t=this;cc.loader.loadRes("texture/block"+this.block_stat,cc.SpriteFrame,function(e,o){t.node.getComponent(cc.Sprite).spriteFrame=o})},onClickBlock:function(){this.node.getParent().getComponent("BlockLine").onClickBlock(this.node.getComponent(cc.Widget).top)},BlockDown:function(e,t){var o=this;cc.tween(this.node.getComponent(cc.Widget)).to(.2,{top:e,bottom:t},{progress:function(e,t,n,c){return o.progresscallback(e,t,c)}}).to(.07,{top:e-.05,bottom:t+.05},{progress:function(e,t,n,c){return o.progresscallback(e,t,c)}}).to(.04,{top:e,bottom:t},{progress:function(e,t,n,c){return o.progresscallback(e,t,c)}}).start()},progresscallback:function(e,t,o){try{this.node.getComponent(cc.Widget).enabled=!0}catch(e){}return e+(t-e)*o}}),cc._RF.pop()},{}],Fog:[function(e,t,o){"use strict";cc._RF.push(t,"7d309ISIstKwpOZTuUaI2Cu","Fog"),cc.Class({extends:cc.Component,properties:{},start:function(){var e=this;cc.tween(this.node).delay(.3).call(function(){e.node.destroy()}).start()}}),cc._RF.pop()},{}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"197c9clbndF6Iq+nyMZ1Blf","Game"),cc.Class({extends:cc.Component,properties:{guide_dlg:cc.Node,pause_dlg:cc.Node,level_dlg:cc.Node},onLoad:function(){this.guide_dlg.active=!0},onClose_guid:function(){this.guide_dlg.active=!1},onClose_pause:function(){this.pause_dlg.active=!1},onClose_level:function(){this.level_dlg.active=!1},onPause_dlg:function(){this.pause_dlg.active=!0}}),cc._RF.pop()},{}],Globals:[function(e,t,o){"use strict";cc._RF.push(t,"dca88jpta1DuK/bXuQ1Lw8z","Globals"),window.Global={gameover:0,gamepause:0,gamelevel:1,gamescore:0,gamelevelscore:0,gamesublevel:1,volume:0},cc._RF.pop()},{}],Guide_dlg:[function(e,t,o){"use strict";cc._RF.push(t,"c1ee3TLeDtCDrEYiXGmO1Vh","Guide_dlg"),cc.Class({extends:cc.Component,properties:{guide_text:[cc.Node],index:0},onLoad:function(){this.guide_text[0].active=!0,this.guide_text[1].active=!1,this.index=0},onPrev:function(){this.guide_text[this.index].active=!1,0===this.index?this.index=this.guide_text.length-1:this.index--,this.guide_text[this.index].active=!0},onNext:function(){this.guide_text[this.index].active=!1,this.index===this.guide_text.length-1?this.index=0:this.index++,this.guide_text[this.index].active=!0}}),cc._RF.pop()},{}],Level_dlg:[function(e,t,o){"use strict";cc._RF.push(t,"994f7PfcrlGc7dwIlLJgR/8","Level_dlg"),cc.Class({extends:cc.Component,properties:{level:cc.Label},start:function(){level.string="Level "+(Global.gamelevel+1)},onHome:function(){cc.director.loadScene("Splash"),this.node.active=!1}}),cc._RF.pop()},{}],Over_dlg:[function(e,t,o){"use strict";cc._RF.push(t,"716e2DnHM9Edr5+c+gBh4ad","Over_dlg"),cc.Class({extends:cc.Component,properties:{gamescore:cc.Label,highscore:cc.Label},onLoad:function(){},onHome:function(){cc.director.loadScene("Splash"),this.node.active=!1},setScore:function(e,t){this.gamescore.string="Score: "+e,this.highscore.string="Best: "+t}}),cc._RF.pop()},{}],Pause_dlg:[function(e,t,o){"use strict";cc._RF.push(t,"287cbLQs3pHhKfBgDL21q36","Pause_dlg"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},onHome:function(){cc.director.loadScene("Splash"),this.node.active=!1}}),cc._RF.pop()},{}],Splash:[function(e,t,o){"use strict";cc._RF.push(t,"527aam0To5AeYaCXZdm0Zxj","Splash"),cc.Class({extends:cc.Component,properties:{loadingBar:cc.ProgressBar,SpriteMain:cc.Node},onLoad:function(){this.loadingBar.progress=0,this.schedule(function(){this.loadingBar.progress>=1&&(this.SpriteMain.active=!0),this.loadingBar.progress+=.1},.3)}}),cc._RF.pop()},{}],blockNode:[function(e,t,o){"use strict";cc._RF.push(t,"22bc4w96RZPq4OVadAiSHB7","blockNode");var n=e("../storageManager");cc.Class({extends:cc.Component,properties:{blockline:cc.Prefab,moveTimer:cc.Integer,floor:cc.Node,ceil:cc.Node,level:cc.Label,sublevel:cc.Label,mark:cc.Label,over_dlg:cc.Node,level_dlg:cc.Node,complete_dlg:cc.Node,finish_move:0,movecount:0,dig:cc.Node,mousePos:cc.v2,digSpeed:cc.v2,digmoveflg:0,selectedx:0,selectedy:0,mark_pre:cc.Prefab,mark_pos:cc.Node,Scene_node:cc.Node,mark_count:cc.Object},start:function(){var e=this;this.node.on("mousedown",function(t){0==e.digmoveflg&&(e.mousePos=cc.v2(t.getLocation().x,t.getLocation().y))}),this.onGameInit()},onGameInit:function(){this.dig.zIndex=999999,this.cloneBlockLine(0),this.onGameStart(),Global.gamesublevel=1,this.sublevel.string=Global.gamesublevel+"/"+(14+4*Global.gamelevel),this.level.string="LEVEL"+Global.gamelevel},onGameStart:function(){this.schedule(this.callback,8)},callback:function(){this.moveBlock()},moveBlock:function(){this.checkFinish()||(this.finish_move=1,this.moveTimer=0,this.cloneBlockLine(-100),console.log(this.node.children),this.movecount=0,this.schedule(this.setMoveCount,.1))},setMoveCount:function(){this.unschedule(this.setMoveCount);for(var e=this.node.children.length-1;e>=0;e--)"dig"!=this.node.children[e].name&&this.node.children[e].getComponent(cc.Widget).left<=this.node.children[this.movecount].getComponent(cc.Widget).left+100&&(this.movecount=e);this.schedule(this.moveCallback,.05),this.floor.getComponent(cc.Animation).play("floor"),this.ceil.getComponent(cc.Animation).play("shake")},moveCallback:function(){if(100==this.moveTimer)return this.unschedule(this.moveCallback),Global.gamesublevel++,this.sublevel.string=Global.gamesublevel+"/"+(14+4*Global.gamelevel),this.checkGameOver(),void(this.finish_move=0);for(var e=this.node.children.length-1;e>=this.movecount;e--)"dig"!=this.node.children[e].name&&(this.node.children[e].getComponent(cc.Widget).enabled=!0,this.node.children[e].getComponent(cc.Widget).left+=20);this.moveTimer+=20},cloneBlockLine:function(e){var t=cc.instantiate(this.blockline);t.getComponent(cc.Widget).left=e,t.getComponent("BlockLine").initBlocks(),this.node.addChild(t)},onForceMove:function(){0==this.finish_move&&(this.finish_move=1,this.unschedule(this.callback),this.schedule(this.callback,8),this.moveBlock())},checkGameOver:function(){for(var e=0;e<this.node.children.length-1;e++){this.node.children[e].getComponent(cc.Widget).left>=1e3&&(Global.gameover=1,this.unschedule(this.callback),this.over_dlg.active=!0,this.over_dlg.getComponent("Over_dlg").setScore(Global.gamescore,n.getHighestScore()))}},onCloseOver:function(){for(var e=this.node.children.length-2;e>=0;e--)this.node.children[e].destroy();this.onGameInit()},onRestartGame:function(){this.onCloseOver(),this.over_dlg.active=!1,this.level_dlg.active=!1,this.mark.string=Global.gamelevelscore},onBlockClicked:function(e,t){0==this.digmoveflg&&(this.dig.x=1065,this.dig.y=385,this.dig.setRotation(90),this.dig.active=!0,this.dig.zIndex=999999,this.digSpeed=cc.v2((this.mousePos.x-this.dig.x)/10,(this.mousePos.y-this.dig.y)/10),this.digmoveflg=0,this.schedule(this.digmove,.01),this.selectedx=t/100,this.selectedy=5-e/.166)},digmove:function(){this.digmoveflg++,this.dig.x+=this.digSpeed.x,this.dig.y+=this.digSpeed.y,this.dig.setRotation(Math.abs(this.dig.rotation)-10),10==this.digmoveflg&&(cc.tween(this).to(.5,{digmoveflg:0}).start(),this.unschedule(this.digmove),this.dig.setRotation(90),this.dig.active=!1,this.getRemovable())},getRemovable:function(){var e=[];console.log(this.node.children);for(var t=this.node.children.length-2;t>=0;t--){if(t!=this.node.children.length-2&&!this.node.children[t].getComponent(cc.Widget).left<=this.node.children[t+1].getComponent(cc.Widget).left+100){console.log("aasdf");for(var o=0;o<parseInt((this.node.children[t].getComponent(cc.Widget).left-this.node.children[t+1].getComponent(cc.Widget).left-100)/100);o++)e[e.length]=[]}e[e.length]=this.node.children[t].getComponent("BlockLine").getBlockState()}var n=this.computeDestroy(this.selectedx,this.selectedy,e);console.log(e),console.log("columns:"),console.log(n);var c=[];for(t=0;t<n.length;t++){var i=0;for(o=0;o<=n[t].x;o++)0==e[o].length&&i++;n[t].x-=i}for(t=0;t<n.length;t++){var s=0;for(o=0;o<c.length;o++)c[o]==n[t].x&&s++;0==s&&(c[c.length]=n[t].x),this.node.children[this.node.children.length-2-n[t].x].getComponent("BlockLine").setRemoveBlocks(n[t].y)}if(1!=n.length){var l=[];for(t=0;t<c.length;t++){var r=this.node.children[this.node.children.length-2-c[t]].getComponent("BlockLine").getLineMark();for(o=0;o<r.length;o++)l[l.length]=r[o]}console.log("mark_arr"),console.log(l),this.showMark(l);for(t=0;t<c.length;t++)this.node.children[this.node.children.length-2-c[t]].getComponent("BlockLine").startRemoveBlocks()}else this.node.children[this.node.children.length-2-c[0]].getComponent("BlockLine").startFogBlock()},showMark:function(e){for(var t=this,o=parseInt(this.mark.string),c=0;c<e.length;c++)if(0!=e[c].mark){var i=cc.instantiate(this.mark_pre),s=e[c].mark;1==e[c].type&&(s=e[c].mark*e.length),1==e[c].multi&&(s*=2),i.getComponent("mark").setmark(s),this.Scene_node.addChild(i),i.getComponent(cc.Widget).enabled=!0,i.getComponent(cc.Widget).left=e[c].left,i.getComponent(cc.Widget).isAbsoluteTop=!1,i.getComponent(cc.Widget).top=e[c].top/.166*.116+.1,console.log(i.getComponent(cc.Widget)),i.getComponent("mark").movePos(this.mark_pos.position),o+=s}this.mark_count={count:0},this.mark_count.count=parseInt(this.mark.string),cc.tween(this.mark_count).delay(.3).to(.2,{count:o},{progress:function(e,o,n,c){return t.updateMark(e,o,n,c)}}).start(),Global.gamescore=o,n.getHighestScore()<o&&n.setHighestScore(o)},updateMark:function(e,t,o,n){var c=parseInt(e+(t-e)*n);return this.mark.string=c.toString(),c},computeDestroy:function(e,t,o){var n=[],c=function(e,t){var n=o[e];return null!=n&&null!=n[t]};return function e(t,i,s){if(c(t,i)&&o[t][i]==s){for(var l=0;l<n.length;++l)if(n[l].x==t&&n[l].y==i)return;n.push({x:t,y:i}),e(t,i-1,s),e(t,i+1,s),e(t-1,i,s),e(t+1,i,s)}}(e,t,o[e][t]),n},checkFinish:function(){if(Global.gamesublevel==4*Global.gamelevel+14)return this.unschedule(this.callback),this.complete_dlg.active=!0,this.complete_dlg.getComponent(cc.Animation).play("layerout"),!0},completedlg_over:function(){this.complete_dlg.getComponent(cc.Animation).play("layerin");var e=this;cc.tween(this.node).delay(.4).call(function(){e.level_dlg.active=!0}).start()},onLevelDlgover:function(){this.level_dlg.active=!1,Global.gamelevelscore=Global.gamescore,this.mark.string=Global.gamescore,Global.gamelevel++,this.onCloseOver()}}),cc._RF.pop()},{"../storageManager":"storageManager"}],mark:[function(e,t,o){"use strict";cc._RF.push(t,"98bcbGYLnBD76lQfUfaMLgt","mark"),cc.Class({extends:cc.Component,properties:{},start:function(){},setmark:function(e){this.node.getComponent(cc.Label).string="+"+e},movePos:function(e){console.log(e);var t=this;cc.tween(this.node).delay(.2).to(.3,{position:cc.v2(e.x,e.y)}).call(function(){t.node.destroy()}).start()}}),cc._RF.pop()},{}],storageManager:[function(e,t,o){"use strict";cc._RF.push(t,"f7aa0qZxrxJhJ7omun042Ei","storageManager");var n=(cc.sys.localStorage.highestScore||(cc.sys.localStorage.highestScore=0),{getHighestScore:function(){return cc.sys.localStorage.highestScore},setHighestScore:function(e){cc.sys.localStorage.highestScore=e}});t.exports=n,cc._RF.pop()},{}]},{},["Globals","BeginGame","Block","BlockLine","Fog","Game","Guide_dlg","Level_dlg","Over_dlg","Pause_dlg","Splash","blockNode","mark","storageManager"]);